<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>⏰ Voice Alarm App</title>
  <link rel="manifest" href="manifest.json">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    :root {
      --primary-color: #007bff;
      --secondary-color: #212529;
      --success-color: #28a745;
      --danger-color: #dc3545;
    }

    body {
      background-color: #f0f2f5;
      padding: 1rem;
      font-family: "Arial", sans-serif;
      min-height: 100vh;
      display: flex;
      align-items: center;
    }

    .clock {
      font-size: 2rem;
      font-weight: bold;
      text-align: center;
      background: var(--secondary-color);
      color: #fff;
      border-radius: 15px;
      padding: 12px;
      box-shadow: 0px 4px 12px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
      margin: 0 auto;
      max-width: 100%;
    }

    @media (min-width: 400px) {
      .clock {
        font-size: 2.5rem;
        padding: 15px;
      }
    }

    @media (min-width: 576px) {
      .clock {
        font-size: 3rem;
        padding: 20px;
        border-radius: 20px;
      }
    }

    @media (min-width: 768px) {
      .clock {
        font-size: 3.5rem;
      }
    }

    .ringing {
      animation: shake 0.5s infinite;
    }

    @keyframes shake {
      0% {
        transform: rotate(0deg);
      }

      25% {
        transform: rotate(-10deg);
      }

      50% {
        transform: rotate(10deg);
      }

      75% {
        transform: rotate(-10deg);
      }

      100% {
        transform: rotate(0deg);
      }
    }

    .bell-icon {
      width: 30px;
      height: auto;
      margin-right: 8px;
      transition: all 0.3s ease;
    }

    @media (min-width: 400px) {
      .bell-icon {
        width: 35px;
      }
    }

    @media (min-width: 576px) {
      .bell-icon {
        width: 50px;
      }
    }

    .btn-custom {
      background-color: var(--success-color);
      color: white;
      font-weight: bold;
      transition: all 0.3s ease;
      padding: 10px 15px;
      border-radius: 8px;
      font-size: 16px;
    }

    .btn-custom:hover {
      background-color: #218838;
      transform: translateY(-2px);
    }

    .btn-danger-custom {
      background-color: var(--danger-color);
      color: white;
      font-weight: bold;
      transition: all 0.3s ease;
      padding: 10px 15px;
      border-radius: 8px;
      font-size: 16px;
    }

    .btn-danger-custom:hover {
      background-color: #c82333;
      transform: translateY(-2px);
    }

    .form-select,
    .form-control {
      background-color: #f8f9fa;
      border: 1px solid #ced4da;
      padding: 10px 12px;
      border-radius: 8px;
      transition: all 0.3s ease;
      font-size: 16px;
    }

    .form-control:focus,
    .form-select:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 0.25rem rgba(0, 123, 255, 0.25);
    }

    .container {
      width: 100%;
      max-width: 800px;
      margin: 0 auto;
      padding: 15px;
      background: white;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    @media (min-width: 576px) {
      .container {
        padding: 20px;
        border-radius: 20px;
      }
    }

    .alarm-status {
      font-size: 0.9rem;
      color: var(--primary-color);
      min-height: 20px;
      transition: all 0.3s ease;
      word-break: break-word;
    }

    @media (min-width: 400px) {
      .alarm-status {
        font-size: 1rem;
        min-height: 24px;
      }
    }

    @media (min-width: 576px) {
      .alarm-status {
        font-size: 1.2rem;
      }
    }

    .title-text {
      font-size: 1.5rem;
      color: var(--primary-color);
      text-align: center;
      margin-bottom: 1rem;
      transition: all 0.3s ease;
    }

    @media (min-width: 400px) {
      .title-text {
        font-size: 1.8rem;
      }
    }

    @media (min-width: 576px) {
      .title-text {
        font-size: 2.2rem;
      }
    }

    .icon-container {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }

    /* Touch-friendly improvements */
    select,
    input,
    button {
      -webkit-appearance: none;
      appearance: none;
      font-size: 16px;
      /* Prevents iOS zoom on focus */
    }

    /* Improved spacing */
    .mb-4 {
      margin-bottom: 1.5rem !important;
    }

    .mt-4 {
      margin-top: 1.5rem !important;
    }

    /* Dark mode support */
    @media (prefers-color-scheme: dark) {
      body {
        background-color: #121212;
      }

      .container {
        background-color: #1e1e1e;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
      }

      .form-select,
      .form-control {
        background-color: #2d2d2d;
        color: #e0e0e0;
        border-color: #444;
      }

      .title-text {
        color: #4d9fff;
      }

      .alarm-status {
        color: #4d9fff;
      }
    }

    /* Extra small devices specific styles */
    @media (max-width: 400px) {

      .col-md-4,
      .col-md-8 {
        padding-left: 5px;
        padding-right: 5px;
      }

      .btn-custom,
      .btn-danger-custom {
        padding: 8px 12px;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="icon-container">
      <img src="https://cdn-icons-png.flaticon.com/512/130/130276.png" id="bellIcon" class="bell-icon d-none"
        alt="Ringing Bell" />
      <h1 class="title-text">⏰ Voice Alarm Clock</h1>
    </div>

    <div class="clock mb-4" id="clock">--:--:--</div>

    <form id="alarmForm" class="row g-3">
      <div class="col-md-4 col-12">
        <label for="alarmTime" class="form-label">Alarm Time</label>
        <input type="time" id="alarmTime" class="form-control" required />
      </div>
      <div class="col-md-8 col-12">
        <label for="alarmMsg" class="form-label">Alarm Message</label>
        <input type="text" id="alarmMsg" class="form-control" placeholder="Enter message (Urdu / Punjabi / English)"
          required />
      </div>
      <div class="col-12 mb-3">
        <label for="voiceSelect" class="form-label">Select Voice</label>
        <select id="voiceSelect" class="form-select" required>
          <option value="">Select Voice</option>
        </select>
      </div>
      <div class="col-12">
        <button type="submit" class="btn btn-custom w-100">Set Alarm</button>
      </div>
    </form>

    <div class="text-center mt-4">
      <div id="alarmStatus" class="alarm-status mb-2"></div>
      <button id="stopBtn" class="btn btn-danger-custom d-none">
        Stop Alarm
      </button>
    </div>

    <audio id="alarmAudio" loop>
      <source src="https://www.soundjay.com/button/beep-07.wav" type="audio/wav" />
    </audio>
  </div>

  <script>
    const clock = document.getElementById("clock");
    const alarmForm = document.getElementById("alarmForm");
    const alarmTimeInput = document.getElementById("alarmTime");
    const alarmMsgInput = document.getElementById("alarmMsg");
    const alarmStatus = document.getElementById("alarmStatus");
    const alarmAudio = document.getElementById("alarmAudio");
    const bellIcon = document.getElementById("bellIcon");
    const voiceSelect = document.getElementById("voiceSelect");
    const stopBtn = document.getElementById("stopBtn");

    let alarmTime = null;
    let alarmMessage = "";
    let selectedVoice = null;
    let alarmInterval = null;

    function updateClock() {
      const now = new Date();
      clock.textContent = now.toLocaleTimeString();
      const current = now.toTimeString().slice(0, 5);
      if (alarmTime === current) {
        triggerAlarm();
      }
      requestAnimationFrame(updateClock);
    }

    function populateVoices() {
      const voices = speechSynthesis.getVoices();
      voiceSelect.innerHTML = '<option value="">Select Voice</option>';

      // Group voices by language with special handling for Punjabi
      const grouped = {};

      voices.forEach((voice, index) => {
        // Normalize language codes (handle both 'pa' and 'pa-IN')
        const langParts = voice.lang.toLowerCase().split("-");
        const baseLang = langParts[0];

        // Special case for Punjabi
        const displayLang =
          baseLang === "pa" ? "Punjabi" : baseLang.toUpperCase();

        if (!grouped[displayLang]) grouped[displayLang] = [];
        grouped[displayLang].push({ voice, index });
      });

      // Sort languages alphabetically but put Punjabi first if it exists
      const sortedLangs = Object.keys(grouped).sort((a, b) => {
        if (a === "Punjabi") return -1;
        if (b === "Punjabi") return 1;
        return a.localeCompare(b);
      });

      sortedLangs.forEach((lang) => {
        const optgroup = document.createElement("optgroup");
        optgroup.label = lang;

        // Sort voices within each language group
        grouped[lang].sort((a, b) =>
          a.voice.name.localeCompare(b.voice.name)
        );

        grouped[lang].forEach(({ voice, index }) => {
          const option = document.createElement("option");
          option.value = index;
          option.text = `${voice.name} (${voice.lang})`;
          optgroup.appendChild(option);
        });

        voiceSelect.appendChild(optgroup);
      });

      // Auto-select Punjabi voice if available
      if (grouped["Punjabi"] && grouped["Punjabi"].length > 0) {
        const punjabiVoice = grouped["Punjabi"][0];
        voiceSelect.value = punjabiVoice.index;
      }
    }

    // Voice preview
    voiceSelect.addEventListener("change", () => {
      const selectedIndex = voiceSelect.value;
      if (!selectedIndex) return;

      const previewVoice = speechSynthesis.getVoices()[selectedIndex];

      if (previewVoice) {
        let previewText = "This is a voice preview.";
        if (previewVoice.lang.startsWith("pa")) {
          previewText = "ਇਹ ਇੱਕ ਵੌਇਸ ਪਰਿਵੇਖਣ ਹੈ।"; // Punjabi preview text
        } else if (previewVoice.lang.startsWith("ur")) {
          previewText = "یہ ایک آواز کا پیش نظارہ ہے۔"; // Urdu preview text
        }

        const utterance = new SpeechSynthesisUtterance(previewText);
        utterance.voice = previewVoice;
        utterance.lang = previewVoice.lang;
        speechSynthesis.cancel();
        speechSynthesis.speak(utterance);
      }
    });

    // Handle voice changes on Chrome
    speechSynthesis.onvoiceschanged = populateVoices;

    alarmForm.addEventListener("submit", (e) => {
      e.preventDefault();
      alarmTime = alarmTimeInput.value;
      alarmMessage = alarmMsgInput.value;
      const selectedIndex = voiceSelect.value;

      if (!selectedIndex) {
        alarmStatus.textContent = "⚠️ Please select a voice";
        alarmStatus.style.color = "var(--danger-color)";
        return;
      }

      selectedVoice = speechSynthesis.getVoices()[selectedIndex];
      alarmStatus.textContent = `⏳ Alarm set for ${alarmTime} - "${alarmMessage}"`;
      alarmStatus.style.color = "var(--primary-color)";

      // Visual feedback
      const submitBtn = e.target.querySelector('button[type="submit"]');
      submitBtn.innerHTML = "✅ Alarm Set!";
      setTimeout(() => {
        submitBtn.innerHTML = "Set Alarm";
      }, 2000);
    });

    function triggerAlarm() {
      alarmStatus.textContent = `🔔 Alarm ringing: "${alarmMessage}"`;
      bellIcon.classList.remove("d-none");
      bellIcon.classList.add("ringing");
      alarmAudio.play();
      stopBtn.classList.remove("d-none");

      // Vibration for mobile devices if supported
      if (navigator.vibrate) {
        navigator.vibrate([300, 100, 300, 100, 300]);
      }

      speakMessage();
      alarmInterval = setInterval(speakMessage, 10000);
    }

    function speakMessage() {
      if (!selectedVoice) return;

      const msg = new SpeechSynthesisUtterance();
      msg.text = alarmMessage;
      msg.voice = selectedVoice;
      msg.lang = selectedVoice.lang;
      msg.pitch = 1;
      msg.rate = 0.9; // Slightly slower for better comprehension

      // Special handling for Punjabi/Urdu messages
      if (
        selectedVoice.lang.startsWith("pa") ||
        selectedVoice.lang.startsWith("ur")
      ) {
        msg.rate = 0.85; // Even slower for complex scripts
      }

      speechSynthesis.speak(msg);
    }

    stopBtn.addEventListener("click", stopAlarm);

    function stopAlarm() {
      alarmAudio.pause();
      alarmAudio.currentTime = 0;
      speechSynthesis.cancel();
      clearInterval(alarmInterval);
      bellIcon.classList.add("d-none");
      bellIcon.classList.remove("ringing");
      stopBtn.classList.add("d-none");
      alarmTime = null;
      alarmMessage = "";
      selectedVoice = null;
      alarmStatus.textContent = "✅ Alarm stopped.";
      alarmStatus.style.color = "var(--success-color)";

      // Reset form for better UX
      alarmForm.reset();

      // Reset time to current time + 1 minute
      const now = new Date();
      now.setMinutes(now.getMinutes() + 1);
      const hours = String(now.getHours()).padStart(2, "0");
      const mins = String(now.getMinutes()).padStart(2, "0");
      alarmTimeInput.value = `${hours}:${mins}`;
    }

    // Check for browser support
    document.addEventListener("DOMContentLoaded", function () {
      if (!("speechSynthesis" in window)) {
        alarmStatus.textContent =
          "⚠️ Speech synthesis not supported in this browser.";
        alarmStatus.style.color = "var(--danger-color)";
        voiceSelect.disabled = true;
      }

      // Initial voice population
      populateVoices();

      // Some browsers need a delay before voices are ready
      setTimeout(populateVoices, 500);
    });

    // Initialize the clock
    updateClock();

    // Set default time to current time + 1 minute for better UX
    const now = new Date();
    now.setMinutes(now.getMinutes() + 1);
    const hours = String(now.getHours()).padStart(2, "0");
    const mins = String(now.getMinutes()).padStart(2, "0");
    alarmTimeInput.value = `${hours}:${mins}`;
  </script>
</body>

</html>